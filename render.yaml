services:
  - type: web
    name: dnc-portal-backend
    env: python
    plan: free
    buildCommand: |
      cd backend
      pip install poetry
      poetry install
      poetry run alembic upgrade head
    startCommand: |
      cd backend
      poetry run uvicorn do_not_call.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: DATABASE_URL
        value: postgresql+psycopg2://traadmin:TPSZen2025%40%21@dnc.postgres.database.azure.com:5432/postgres?sslmode=require
      - key: PGHOST
        value: dnc.postgres.database.azure.com
      - key: PGUSER
        value: traadmin
      - key: PGPORT
        value: 5432
      - key: PGDATABASE
        value: postgres
      - key: PGPASSWORD
        value: TPSZen2025@!
      - key: DEBUG
        value: false
      - key: LOG_LEVEL
        value: INFO

  - type: web
    name: dnc-portal-frontend
    env: static
    plan: free
    buildCommand: |
      cd frontend
      npm install -g pnpm
      pnpm install
      pnpm build
    staticPublishPath: ./frontend/dist
    envVars:
      - key: VITE_API_BASE_URL
        value: https://dnc-portal-backend.onrender.com
      - key: VITE_ENTRA_TENANT_ID
        value: 185fc38c-2c1b-4307-a164-24a4072e83e1
      - key: VITE_ENTRA_SPA_CLIENT_ID
        value: a2a6c2c2-cb10-411e-a354-da61bfa4a3b2
      - key: VITE_ENTRA_SCOPE
        value: api://a2a6c2c2-cb10-411e-a354-da61bfa4a3b2/access_as_user